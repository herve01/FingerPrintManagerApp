<UserControl x:Class="FingerPrintManagerApp.Modules.Employe.View.EmployeListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:FingerPrintManagerApp.View"
             xmlns:gif="http://wpfanimatedgif.codeplex.com" 
             xmlns:converter="clr-namespace:FingerPrintManagerApp.View.Converter"
             xmlns:ctrl="clr-namespace:ARG.Controls"
             xmlns:model="clr-namespace:FingerPrintManagerApp.Model.Employe"
             xmlns:interactivity="http://schemas.microsoft.com/expression/2010/interactivity"
             mc:Ignorable="d" 
             Name="this"
             Loaded="This_Loaded"
             Background="{StaticResource Window.Background}"
             >
    <interactivity:Interaction.Triggers>
        <interactivity:EventTrigger EventName="Loaded">
            <interactivity:InvokeCommandAction Command="{Binding LoadCommand}" />
        </interactivity:EventTrigger>
    </interactivity:Interaction.Triggers>
    <UserControl.Resources>

        <local:BindingProxy x:Key="proxy" Data="{Binding}" />

        <converter:PercentageConverter x:Key="percentageConverter" />

        <converter:BoolToVisibilityConverter x:Key="boolToVisibilityConverter" />
        <converter:MultipleCommandParamConverter x:Key="multiCommandParameterConverter" />
        <converter:ListViewItemToPositionConverter x:Key="listViewItemToPositionConverter" />
        <converter:ListViewItemPositionToBackgroundConverter x:Key="listViewItemPositionToBackgroundConverter" />
        <converter:ByteArrayToImageThumbnailConverter x:Key="thumbnailConverter" />
        
        <ContextMenu x:Key="MenuEmploye">
            <MenuItem Header="Voir les détails" 
                      Command="{Binding Source={StaticResource proxy}, Path=Data.VisualizeEmployeCommand}"
                      >
                <MenuItem.CommandParameter>
                    <MultiBinding Converter="{StaticResource multiCommandParameterConverter}">
                        <Binding />
                        <Binding RelativeSource="{RelativeSource AncestorType=Window}"/>
                    </MultiBinding>
                </MenuItem.CommandParameter>
            </MenuItem>

            <MenuItem Header="Imprimer carte de service" 
                      Command="{Binding Source={StaticResource proxy}, Path=Data.PrintCarteServiceRectoCommand}"
                      CommandParameter="{Binding}"/>
            <Separator />

            <MenuItem Header="Changer photo de profil" 
                      Command="{Binding Source={StaticResource proxy}, Path=Data.ChangePhotoCommand}"
                      CommandParameter="{Binding}"/>

            <MenuItem Header="Modifier les empreintes" 
                      Command="{Binding Source={StaticResource proxy}, Path=Data.ChangeFingerPrintCommand}"
                      >
                <MenuItem.CommandParameter>
                    <MultiBinding Converter="{StaticResource multiCommandParameterConverter}">
                        <Binding />
                        <Binding RelativeSource="{RelativeSource AncestorType=Window}"/>
                    </MultiBinding>
                </MenuItem.CommandParameter>
            </MenuItem>
            
            <MenuItem Header="Modifier l'employé" 
                      Command="{Binding Source={StaticResource proxy}, Path=Data.EditEmployeCommand}">
                <MenuItem.CommandParameter>
                    <MultiBinding Converter="{StaticResource multiCommandParameterConverter}">
                        <Binding />
                        <Binding RelativeSource="{RelativeSource AncestorType=Window}"/>
                    </MultiBinding>
                </MenuItem.CommandParameter>
            </MenuItem>


        </ContextMenu>

        <DataTemplate x:Key="EmployeTemplate" DataType="{x:Type model:Employe}">
            <Border Name="border" 
                    Padding="10,5"
                    ContextMenu="{DynamicResource MenuEmploye}"
                    MaxHeight="80"
                    Background="Transparent">
                <Grid Name="gridDet">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="40" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="60" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="80" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="80" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="{Binding RelativeSource={RelativeSource AncestorType=ListViewItem}, Converter={StaticResource listViewItemToPositionConverter}}" 
                               Grid.Column="0"
                               FontSize="13"
                               FontWeight="DemiBold"
                               VerticalAlignment="Center"/>

                    <Border Width="1" 
                            Grid.Column="1" 
                            Margin="5,0" />

                    <Grid Grid.Column="2"
                          Width="{Binding ElementName=brd, Path=ActualWidth, Converter={StaticResource percentageConverter}, ConverterParameter='39,380'}">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>

                        <Border CornerRadius="4"
                                Height="45"
                                Width="35"
                                Background="#e1f0ff"
                                VerticalAlignment="Top"
                                Margin="0 0 10 0">
                            <Grid>
                                <TextBlock Text="{Binding Initials}"
                                           VerticalAlignment="Center"
                                           HorizontalAlignment="Center"
                                           Foreground="#3699ff"
                                               />
                                <Image Source="{Binding Path=Photo, IsAsync=True, Converter={StaticResource thumbnailConverter}, ConverterParameter='105,135'}">
                                    <Image.Clip>
                                        <RectangleGeometry Rect="0 0 35 45" 
                                                           RadiusX="4" 
                                                           RadiusY="4"  />
                                    </Image.Clip>
                                </Image>
                            </Grid>

                        </Border>

                        <StackPanel Grid.Column="1">
                            <ctrl:HightlightTextBlock Text="{Binding Name, FallbackValue='-'}" 
                                                      HightlightText="{Binding Data.EmployeFilterText, Source={StaticResource proxy}}"
                                                      FontWeight="DemiBold"
                                                      TextWrapping="WrapWithOverflow"
                                                      FontSize="13"/>
                            <ctrl:HightlightTextBlock HightlightText="{Binding Data.EmployeFilterText, Source={StaticResource proxy}}"
                                                      TextTrimming="CharacterEllipsis"
                                                      FontSize="11"
                                                      Foreground="#555">
                                <ctrl:HightlightTextBlock.Text>
                                    <MultiBinding StringFormat="{}{0} • {1}">
                                        <Binding Path="Sexe" />
                                        <Binding Path="Matricule" />
                                    </MultiBinding>
                                </ctrl:HightlightTextBlock.Text>
                            </ctrl:HightlightTextBlock>
                        </StackPanel>
                    </Grid>

                    <Border Width="1" 
                                    Grid.Column="3" 
                                    Margin="5,0" />

                    <ctrl:HightlightTextBlock TextAlignment="Left"  
                                              Text="{Binding CurrentGradeNomination.Grade.Id, FallbackValue='-'}" 
                                              HightlightText="{Binding Data.EmployeFilterText, Source={StaticResource proxy}}" 
                                              Grid.Column="4"
                                              VerticalAlignment="Center"
                                              FontWeight="DemiBold"
                                              FontSize="13"
                                              />

                    <Border Width="1" 
                            Grid.Column="5" 
                            Margin="5,0" />

                    <ctrl:HightlightTextBlock TextAlignment="Left"  
                                              Text="{Binding CurrentAffectation.Direction.Sigle, FallbackValue='-'}" 
                                              HightlightText="{Binding Data.EmployeFilterText, Source={StaticResource proxy}}" 
                                              TextWrapping="WrapWithOverflow"
                                              TextTrimming="CharacterEllipsis"
                                              VerticalAlignment="Center"
                                              Grid.Column="6"
                                              FontSize="13"/>

                    <Border Width="1" 
                            Grid.Column="7" 
                            Margin="5,0" />

                    <ctrl:HightlightTextBlock TextAlignment="Left"  
                                              Text="{Binding CurrentAffectation.Departement.Denomination, FallbackValue='-'}" 
                                              HightlightText="{Binding Data.EmployeFilterText, Source={StaticResource proxy}}" 
                                              Width="{Binding ElementName=brd, Path=ActualWidth, Converter={StaticResource percentageConverter}, ConverterParameter='30,480'}"
                                              TextWrapping="WrapWithOverflow"
                                              TextTrimming="CharacterEllipsis"
                                              VerticalAlignment="Center"
                                              Grid.Column="8"
                                              FontSize="13"/>

                    <Border Width="1" 
                            Grid.Column="9" 
                            Margin="5,0" />

                    <ctrl:HightlightTextBlock TextAlignment="Left"  
                                              Text="{Binding CurrentAffectation.Entite.Description, FallbackValue='-'}" 
                                              HightlightText="{Binding Data.EmployeFilterText, Source={StaticResource proxy}}" 
                                              Width="{Binding ElementName=brd, Path=ActualWidth, Converter={StaticResource percentageConverter}, ConverterParameter='30,480'}"
                                              TextWrapping="WrapWithOverflow"
                                              TextTrimming="CharacterEllipsis"
                                              VerticalAlignment="Center"
                                              Grid.Column="10"
                                              FontSize="13"/>


                    
                    <Border Width="1" 
                            Grid.Column="11" 
                            Margin="5,0" />

                    <StackPanel Orientation="Horizontal"
                                Grid.Column="12">
                        <Button Command="{Binding Data.VisualizeEmployeCommand, Source={StaticResource proxy}}" 
                                Style="{DynamicResource ButtonFlatIconStyle}"
                                ToolTip="Voir plus de détails sur l'employé"
                                Cursor="Hand"
                                Margin="5 0"
                                Width="24"
                                Height="24"
                                HorizontalAlignment="Left"
                                Tag="M15.599999,5.0000188C17.6,5.0000187 19.3,6.600025 19.3,8.7000329 19.3,10.700041 17.7,12.400047 15.599999,12.400047 13.599999,12.400047 11.9,10.800041 11.9,8.7000329 11.9,8.3000315 12,7.90003 12.099999,7.6000288 12.4,7.8000296 12.9,8.0000304 13.4,8.0000303 14.299999,8.0000304 15.099999,7.2000273 15.099999,6.3000238 15.099999,5.8000219 14.9,5.4000204 14.599999,5.1000192 14.9,5.1000191 15.2,5.0000187 15.599999,5.0000188z M15.599999,2.0000076C12,2.0000072 9.0999994,4.9000183 9.0999994,8.5000322 9.0999994,12.100046 12,15.000057 15.599999,15.000057 19.2,15.000057 22.1,12.100046 22.099999,8.5000322 22.1,4.9000183 19.2,2.0000072 15.599999,2.0000076z M16.2,0C17.1,-4.7683716E-07 27.3,0.20000029 32,8.5000322 32,8.5000324 26.5,16.800065 16,16.100062 16,16.100062 6.6999989,17.000066 0,8.5000322 0,8.5000324 4.1999989,0.20000029 16.2,0z" 
                                Background="#eaeaea" 
                                Foreground="#000">
                            <Button.CommandParameter>
                                <MultiBinding Converter="{StaticResource multiCommandParameterConverter}">
                                    <Binding />
                                    <Binding RelativeSource="{RelativeSource AncestorType=Window}" />
                                </MultiBinding>
                            </Button.CommandParameter>
                        </Button>

                        <Button Command="{Binding Data.EditEmployeCommand, Source={StaticResource proxy}}" 
                                Style="{DynamicResource ButtonFlatIconStyle}"
                                ToolTip="Modifier l'employé"
                                Cursor="Hand"
                                Margin="5 0"
                                Width="24"
                                Height="24"
                                HorizontalAlignment="Left"
                                Tag="M0,22.691865L9.6958332,27.864942 0.24500618,32.000013z M8.8988495,6.3116251L18.869686,12.034729 11.211813,25.370919 10.644821,23.665877 7.7198686,23.364879 7.2188854,21.531844 4.3549361,21.429853 3.5479436,19.422835 1.2459807,19.647815z M13.690775,0.00052993685C13.965764,-0.0064584891,14.233765,0.055554115,14.474758,0.19355655L21.534634,4.2476002C22.392622,4.7375976,22.586618,6.0146238,21.968632,7.0966398L21.126636,8.5616571 10.95782,2.7255753 11.799801,1.2555529C12.243793,0.48054798,12.988775,0.017528671,13.690775,0.00052993685z"
                                Background="#eaeaea" 
                                Foreground="#000">
                            <Button.CommandParameter>
                                <MultiBinding Converter="{StaticResource multiCommandParameterConverter}">
                                    <Binding />
                                    <Binding RelativeSource="{RelativeSource AncestorType=Window}" />
                                </MultiBinding>
                            </Button.CommandParameter>
                        </Button>
                    </StackPanel>

                </Grid>
            </Border> 

            <DataTemplate.Triggers>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType={x:Type ListViewItem}}, Path=IsSelected}" Value="True">
                    <!--<Setter TargetName="gridDet" Property="TextBlock.Foreground" Value="#FFFFFFFF" />
                    <Setter TargetName="border" Property="Background" Value="#FF2888F3" />-->
                </DataTrigger>
            </DataTemplate.Triggers>
        </DataTemplate>

        <Storyboard x:Key="fadeInStatusSB">
            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="brdStatus"
                                           Storyboard.TargetProperty="(UIElement.Visibility)">
                <DiscreteObjectKeyFrame KeyTime="0"
                                        Value="{x:Static Visibility.Visible}" />
            </ObjectAnimationUsingKeyFrames>

            <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                             Storyboard.TargetName="brdStatus"
                             Duration="0:0:1" 
                             To="1.0" />

            <DoubleAnimation Storyboard.TargetProperty="Opacity" 
                             Storyboard.TargetName="brdStatus"
                             Duration="0:0:2" 
                             From="1.0" 
                             To="0.0" 
                             BeginTime="0:0:5"
                             />

            <ObjectAnimationUsingKeyFrames Storyboard.TargetName="brdStatus"
                                           Storyboard.TargetProperty="(UIElement.Visibility)"
                                           BeginTime="0:0:7">
                <DiscreteObjectKeyFrame KeyTime="0"
                                        Value="{x:Static Visibility.Collapsed}" />
            </ObjectAnimationUsingKeyFrames>
        </Storyboard>
    </UserControl.Resources>
    <Grid>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <Border Background="#fff">
                <Border.Effect>
                    <DropShadowEffect BlurRadius="20"
                                      ShadowDepth="15"
                                      Color="#523f69"
                                      Opacity=".08"/>
                </Border.Effect>

            </Border>
            
            <Border Background="#fff"
                    Padding="20 15">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="Employés"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Left"
                               FontSize="16"
                               FontWeight="DemiBold"
                               />

                    <Border Grid.Column="1"
                            Margin="20 0"
                            Height="20"
                            Width="1"
                            Background="{StaticResource Separator.Background}" />

                    <TextBlock Text="{Binding EmployeCount, StringFormat=\{0\} Total, FallbackValue='0 Total'}"
                               FontWeight="DemiBold"
                               VerticalAlignment="Center"
                               TextAlignment="Center"
                               FontSize="14"
                               Grid.Column="3"
                               Margin="15 0"
                               Foreground="#7e8299"
                               
                               />

                    <Grid Grid.Column="4">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <TextBox HorizontalAlignment="Right" 
                                 FontSize="13" 
                                 Height="40"
                                 Width="200"
                                 Tag="Recherche..." 
                                 Text="{Binding EmployeFilterText, UpdateSourceTrigger=PropertyChanged}"
                                 Style="{DynamicResource WebSearchControl}"   />

                        <Button Content="Actualiser" 
                                Style="{DynamicResource ButtonFlatIconStyle}"
                                ToolTip="Actualiser la liste des employés"
                                Cursor="Hand"
                                Margin="10 0"
                                Grid.Column="1"
                                Width="28"
                                Height="28"
                                HorizontalAlignment="Right"
                                Command="{Binding RefreshEmployeCommand}"
                                Tag="M1.6819987,14.044979L9.8970004,17.370966 6.3769976,19.284967C8.2400037,22.789972 11.896001,25.193962 16.141995,25.193962 20.631998,25.193962 24.487993,22.521967 26.233004,18.687982L29.466995,18.687982C27.558001,24.216972 22.313997,28.208 16.141995,28.208 10.761998,28.208 6.0890032,25.17498 3.7130042,20.731012L0,22.747003z M16.141995,0C21.460993,1.3985937E-07,26.084002,2.9670097,28.485001,7.3259868L32,5.3049912 30.530991,14.044979 22.236994,10.916013 25.860003,8.8339815C23.983004,5.3789963 20.351999,3.0140068 16.141995,3.0140066 11.653997,3.0140068 7.7980023,5.6860031 6.0520006,9.518979L2.8189999,9.518979C4.7280031,3.9899892,9.9719973,1.3985937E-07,16.141995,0z"/>

                        <Border Width="30"
                                Height="30"
                                Background="#fff"
                                CornerRadius="15"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Right"
                                Grid.Column="2"
                                Visibility="{Binding EmployeLoading, Converter={StaticResource boolToVisibilityConverter}}"
                            >
                            <Image gif:ImageBehavior.AnimatedSource="/FingerPrintManagerApp;component/View/Image/preloader.gif"
                                   Height="20"
                                   Width="20"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Center"
                                />
                        </Border>
                    </Grid>

                    <StackPanel  Grid.Column="6" Orientation="Horizontal">
                        <Button Content="Actualiser" 
                                Style="{DynamicResource ButtonFlatIconStyle3}"
                                ToolTip="Imprimer"
                                Cursor="Hand"
                                Margin="10 0"
                                Grid.Column="1"
                                Width="32"
                                Height="32"
                                HorizontalAlignment="Right"
                                Name="btnPrint"
                                Click="BtnPrint_Click"
                                Tag="M10,24L20,24 20,26 10,26z M10,20L22,20 22,22 10,22z M8,18L8,30 24,30 24,18z M28,10.400009C27.100006,10.400009 26.400024,11.100006 26.400024,12 26.400024,12.900009 27.100006,13.600006 28,13.600006 28.900024,13.600006 29.600006,12.900009 29.600006,12 29.600006,11.100006 28.900024,10.400009 28,10.400009z M2,8L30,8C31.100006,8,32,8.9000092,32,10L32,22C32,23.100006,31.100006,24,30,24L26,24 26,30C26,31.100006,25.100006,32,24,32L8,32C6.9000244,32,6,31.100006,6,30L6,24 2,24C0.90002441,24,0,23.100006,0,22L0,10C0,8.9000092,0.90002441,8,2,8z M8,0L24,0C25.100006,0,26,0.90000916,26,2L26,6 24,6 24,2 8,2 8,6 6,6 6,2C6,0.90000916,6.9000244,0,8,0z" />

                        <Popup Name="popupPrint" 
                                   HorizontalAlignment="Center" 
                                   Grid.Column="0" AllowsTransparency="True" 
                                   HorizontalOffset="-100" 
                                   PlacementTarget="{Binding ElementName=btnPrint}" 
                                   Placement="Bottom"
                                   StaysOpen="{Binding ElementName=btnPrint, Path=IsMouseOver}">
                            <Grid Margin="10"
                                  Width="240">
                                <Grid>
                                    <Grid.Effect>
                                        <DropShadowEffect ShadowDepth="0" Opacity="0.4"/>
                                    </Grid.Effect>
                                    <Border Background="#fff"
                                            Grid.Row="1"
                                            CornerRadius="8"
                                        >
                                    </Border>

                                </Grid>

                                <Border Background="#FFFFFFFF"
                                        CornerRadius="8" 
                                        Padding="10" 
                                        Grid.Row="1">
                                    <StackPanel>
                                        <StackPanel Visibility="{Binding PermanentSelected, Converter={StaticResource boolToVisibilityConverter}}"
                                                >
                                            <TextBlock Text="Effectifs"
                                                       FontWeight="DemiBold"
                                                       Foreground="#888"
                                                       HorizontalAlignment="Center"
                                                       Typography.Capitals="AllSmallCaps"
                                                       Margin="0 2"
                                                       />
                                            <Button Content="Liste déclarative"
                                                        Template="{DynamicResource BtnActionMacStyle}"
                                                        Height="24"
                                                        Margin="0 0 0 5"
                                                        ToolTip="Imprimer la liste déclarative"
                                                        Command="{Binding PrintDeclarativeListCommand}"
                                                        CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                                                        HorizontalAlignment="Stretch"
                                                        FontWeight="DemiBold"
                                                        FontSize="13.5"
                                                />

                                            <Button Content="Liste des femmes"
                                                        Template="{DynamicResource BtnActionMacStyle}"
                                                        Height="24"
                                                        Margin="0 0 0 5"
                                                        ToolTip="Imprimer la liste des employés femmes"
                                                        Command="{Binding PrintFemmeListCommand}"
                                                        CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                                                        HorizontalAlignment="Stretch"
                                                        FontWeight="DemiBold"
                                                        FontSize="13.5"
                                                />
                                            
                                            <Button Content="Effectifs par grade"
                                                        Template="{DynamicResource BtnActionMacStyle}"
                                                        Height="24"
                                                        Margin="0 0 0 5"
                                                        ToolTip="Imprimer la liste des effectifs des employés par leurs grades"
                                                        Command="{Binding PrintGradeEffectifCommand}"
                                                        CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                                                        HorizontalAlignment="Stretch"
                                                        FontWeight="DemiBold"
                                                        FontSize="13.5"
                                                />

                                        </StackPanel>

                                        <StackPanel>
                                            <TextBlock Text="Affectation"
                                                       FontWeight="DemiBold"
                                                       Foreground="#888"
                                                       HorizontalAlignment="Center"
                                                       Typography.Capitals="AllSmallCaps"
                                                       Margin="0 2"
                                                       />

                                            <Button Content="Agents affectés"
                                                    Template="{DynamicResource BtnActionMacStyle}"
                                                    Height="24"
                                                    Margin="0 0 0 5"
                                                    ToolTip="Imprimer la liste des agents affectés"
                                                    Command="{Binding PrintAgentsAffectesCommand}"
                                                    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                                                    HorizontalAlignment="Stretch"
                                                    FontWeight="DemiBold"
                                                    FontSize="13.5"
                                                />

                                            <Button Content="Agents en Instance d'affectation"
                                                    Template="{DynamicResource BtnActionMacStyle}"
                                                    Height="24"
                                                    Margin="0 0 0 5"
                                                    ToolTip="Imprimer la liste des agents en instance d'affectation"
                                                    Command="{Binding PrintAgentEnInstanceAffectationCommand}"
                                                    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                                                    HorizontalAlignment="Stretch"
                                                    FontWeight="DemiBold"
                                                    FontSize="13.5"
                                                />

                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </Grid>

                        </Popup>

                        <Button Content="Ajouter un employé"
                                Height="32"
                                FontSize="13.5"                           
                                VerticalAlignment="Center"
                                FontWeight="DemiBold"
                                HorizontalAlignment="Right"
                                HorizontalContentAlignment="Center"
                                Command="{Binding CreateEmployeCommand}"
                                CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                                Template="{DynamicResource BtnActionWebTemplate}"
                            />
                        
                    </StackPanel>

                   
                </Grid>
            </Border>

            <Grid Margin="40 20"
                  Grid.Row="1"
                    >
                <Border CornerRadius="6"
                        Background="#fff"
                        >
                    <Border.Effect>
                        <DropShadowEffect BlurRadius="20"
                                      ShadowDepth="15"
                                      Color="#523f69"
                                      Opacity=".08"/>
                    </Border.Effect>
                </Border>

                <Border CornerRadius="6"
                    Background="#fff"
                    Padding="20 10">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <Grid Margin="0 0 0 20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <StackPanel>
                                <TextBlock Text="Liste des employés"
                                       VerticalAlignment="Center"
                                       HorizontalAlignment="Left"
                                       FontSize="16"
                                       FontWeight="DemiBold"
                               />

                                <TextBlock Text="Faites clic-droit pour voir plus d'options"
                                       VerticalAlignment="Center"
                                       HorizontalAlignment="Left"
                                       FontSize="12"
                                       FontWeight="DemiBold"
                                       Foreground="#a5a5b3"
                               />
                            </StackPanel>

                            <Border Width="20"
                                    Grid.Column="1" />
                            
                            <WrapPanel Grid.Column="2"
                                       HorizontalAlignment="Right">

                                <StackPanel Orientation="Horizontal"
                                            Visibility="{Binding IsSiege, Converter={StaticResource boolToVisibilityConverter}}">

                                    <Path Width="20"
                                          Height="29"
                                          Stretch="Uniform"
                                          VerticalAlignment="Center"
                                          Fill="{StaticResource WebControlForeground}"
                                          Data="M1.9890013,1.9890003L1.9890013,17.906003 29.844015,17.906003 29.844015,1.9890003z M0,0L31.834015,0 31.834015,19.896003 16.829017,19.896003 16.829017,31.005015C16.829016,31.555003 16.383018,32.000011 15.834009,32.000011 15.285014,32.000011 14.839016,31.555003 14.839017,31.005015L14.839017,19.896003 0,19.896003z"
                                          />

                                    <Border Width="10" />

                                    <ComboBox ItemsSource="{Binding DirectionsView}"
                                              SelectedValue="{Binding SelectedDirection, Mode=TwoWay}"
                                              DisplayMemberPath="Sigle"
                                              Width="120" 
                                              IsSynchronizedWithCurrentItem="True"
                                              FontWeight="DemiBold"
                                              VerticalAlignment="Center" 
                                              HorizontalAlignment="Stretch" 
                                              Style="{DynamicResource ComboBoxWebStyle}"
                                              />
                                </StackPanel>
                                
                                <Border Width="20" />
                                
                                <StackPanel Orientation="Horizontal">

                                    <Path Width="30"
                                          Height="30"
                                          Stretch="Uniform"
                                          VerticalAlignment="Center"
                                          Fill="{StaticResource WebControlForeground}"
                                          Data="M7.2000166,25.899994L7.2000166,31 9.0000049,31 9.0000049,25.899994z M4.2999903,25.899994L4.2999903,31 6.2000156,31 6.2000156,25.899994z M1.3999944,25.899994L1.3999944,31 3.2999898,31 3.2999898,25.899994z M7.2000166,19.700012L7.2000166,24.800018 9.0000049,24.800018 9.0000049,19.700012z M4.2999903,19.700012L4.2999903,24.800018 6.2000156,24.800018 6.2000156,19.700012z M1.3999944,19.700012L1.3999944,24.800018 3.2999898,24.800018 3.2999898,19.700012z M0.10000611,18.399994L10.4,18.399994 10.4,32 0.10000611,32z M0,16.399994L10.4,16.399994 10.4,17.5 0,17.5z M5.7999912,12.800018L5.7999912,15 7.6000105,15 7.6000105,12.899994z M2.8999954,12.800018L2.8999954,15 4.7000147,15 4.7000147,12.899994z M5.7999912,9.6000061L5.7999912,11.700012 7.6000105,11.700012 7.6000105,9.6000061z M2.8999954,9.6000061L2.8999954,11.700012 4.7000147,11.700012 4.7000147,9.6000061z M1.7999887,8.8000183L8.7000171,8.8000183 8.7000171,15.600006 1.7999887,15.600006z M5.000003,0L5.3999969,0 5.3999969,5.8999939 7.6000105,5.8999939 7.6000105,7 9.0000049,7 9.0000049,7.7000122 1.3999944,7.7000122 1.3999944,7 2.7999893,7 2.7999893,5.8999939 5.000003,5.8999939z"
                                          />

                                    <Border Width="5" />
                                    
                                    <ComboBox ItemsSource="{Binding EntitesView}"
                                              SelectedValue="{Binding SelectedEntite, Mode=TwoWay}"
                                              Width="200" 
                                              IsSynchronizedWithCurrentItem="True"
                                              FontWeight="DemiBold"
                                              VerticalAlignment="Center" 
                                              HorizontalAlignment="Stretch" 
                                              Style="{DynamicResource ComboBoxWebStyle}"
                                              />
                                </StackPanel>
                            </WrapPanel>
                        </Grid>

                        <Border BorderThickness="0 0 0 1"
                                Grid.Row="1"
                                SnapsToDevicePixels="True" 
                                Background="#f7ffffff" 
                                Padding="10 5 10 10" 
                                BorderBrush="#ebedf3"
                                Name="brd"
                            >
                            <Grid TextBlock.Foreground="#b5b5c3">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="40" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="60" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="80" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="80" />
                                </Grid.ColumnDefinitions>

                                <TextBlock FontWeight="DemiBold" 
                                       Text="#" 
                                       TextAlignment="Left"
                                       FontSize="14"
                                       Grid.Column="0"
                                       Foreground="#3699ff"
                                       Typography.Capitals="AllSmallCaps"
                               />

                                <Border Width="1" 
                                    Grid.Column="1" 
                                    Margin="5,0" />

                                <TextBlock FontWeight="DemiBold" 
                                       Width="{Binding ElementName=brd, Path=ActualWidth, Converter={StaticResource percentageConverter}, ConverterParameter='39,380'}"
                                       Text="Employé" 
                                       FontSize="14"
                                       Grid.Column="2" 
                                       Typography.Capitals="AllSmallCaps"
                               />

                                <Border Width="1" 
                                    Grid.Column="3" 
                                    Margin="5,0" />

                                <TextBlock FontWeight="DemiBold" 
                                       TextAlignment="Left"  
                                       Text="Grade" 
                                       FontSize="14"
                                       Grid.Column="4"
                                       Typography.Capitals="AllSmallCaps"
                               />

                                <Border Width="1"  
                                    Grid.Column="5" 
                                    Margin="5,0" />

                                <TextBlock FontWeight="DemiBold" 
                                           TextAlignment="Left"  
                                           Text="Direction" 
                                           FontSize="14"
                                           Grid.Column="6"
                                           Typography.Capitals="AllSmallCaps"
                                            />

                                <Border Width="1"  
                                        Grid.Column="7" 
                                        Margin="5,0" />

                                <TextBlock FontWeight="DemiBold" 
                                           Width="{Binding ElementName=brd, Path=ActualWidth, Converter={StaticResource percentageConverter}, ConverterParameter='30,380'}"
                                           Text="Departement" 
                                           FontSize="14"
                                           Grid.Column="8" 
                                           Typography.Capitals="AllSmallCaps"
                                           />

                                <Border Width="1" 
                                        Grid.Column="9" 
                                        Margin="5,0" />


                                <TextBlock FontWeight="DemiBold" 
                                           Width="{Binding ElementName=brd, Path=ActualWidth, Converter={StaticResource percentageConverter}, ConverterParameter='30,380'}"
                                           Text="Entité" 
                                           FontSize="14"
                                           Grid.Column="10" 
                                           Typography.Capitals="AllSmallCaps"
                                           />


                                <Border Width="1" 
                                    Grid.Column="11" 
                                    Margin="5,0" 
                            />

                                <TextBlock FontWeight="DemiBold" 
                                       TextAlignment="Left"  
                                       Text="Actions" 
                                       FontSize="14"
                                       Grid.Column="12"
                                       Typography.Capitals="AllSmallCaps"
                               />
                            </Grid>
                        </Border>

                        <ListView Grid.Row="2"
                              Background="Transparent"
                              BorderBrush="Transparent"
                              ItemsSource="{Binding EmployesView}"
                              ItemTemplate="{StaticResource EmployeTemplate}"
                              ItemContainerStyle="{StaticResource ListViewItem.Style.Alternative}">
                            <ListView.GroupStyle>
                                <GroupStyle>
                                    <GroupStyle.ContainerStyle>
                                        <Style TargetType="{x:Type GroupItem}">
                                            <Setter Property="Margin" Value="0 0 0 20" />
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="{x:Type GroupItem}">
                                                        <Grid>
                                                            <Grid.RowDefinitions>
                                                                <RowDefinition Height="Auto" />
                                                                <RowDefinition />
                                                            </Grid.RowDefinitions>
                                                            <Border Background="#e1f0ff"
                                                                    CornerRadius="4"
                                                                    >
                                                                <Grid>
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition />
                                                                        <ColumnDefinition Width="40" />
                                                                    </Grid.ColumnDefinitions>

                                                                    <TextBlock Text="{Binding Name, TargetNullValue='Non affectés'}"
                                                                               FontSize="14"
                                                                               FontWeight="Bold"
                                                                               TextWrapping="WrapWithOverflow"
                                                                               Margin="10 6"
                                                                               Width="{Binding ElementName=brd, Path=ActualWidth, Converter={StaticResource percentageConverter}, ConverterParameter='100,80'}"/>

                                                                    <Border Grid.Column="1"
                                                                            Padding="10 6"
                                                                            CornerRadius="0 4 4 0"
                                                                            Background="#3699ff">

                                                                        <TextBlock Text="{Binding ItemCount, StringFormat={}{0}}"
                                                                                   Foreground="#fff"
                                                                                   FontWeight="DemiBold"
                                                                                   VerticalAlignment="Center"
                                                                                   HorizontalAlignment="Center"/>

                                                                    </Border>
                                                                </Grid>

                                                            </Border>
                                                            <ItemsPresenter Grid.Row="1"/>
                                                        </Grid>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </GroupStyle.ContainerStyle>
                                </GroupStyle>
                            </ListView.GroupStyle>
                        </ListView>
                    </Grid>
                </Border>
            </Grid>
            
            

        </Grid>

        <Border Panel.ZIndex="200"
                Padding="20 7"
                Margin="10"
                Name="brdStatus"
                VerticalAlignment="Bottom"
                MaxWidth="700"
                HorizontalAlignment="Center"
                CornerRadius="4"
                Background="#ff35393c"
                Opacity="0"
                Visibility="Visible">
            <TextBlock Text="{Binding Status, NotifyOnTargetUpdated=True}"
                           Foreground="#fff"
                           Name="txtStatus"
                           TextWrapping="WrapWithOverflow">
            </TextBlock>
        </Border>
    </Grid>
</UserControl>