<Window x:Class="FingerPrintManagerApp.Global.Views.Main"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converter="clr-namespace:FingerPrintManagerApp.View.Converter"
        xmlns:interactivity="http://schemas.microsoft.com/expression/2010/interactivity"
        xmlns:bhv="clr-namespace:FingerPrintManagerApp.ViewModel.Behavior"
        mc:Ignorable="d"
        WindowStartupLocation="CenterScreen"
        Title="FingerPrintManager" 
        Name="MainWindow"
        Height="750" 
        MinHeight="200" 
        WindowState="Maximized" 
        MinWidth="1080"
        Background="{StaticResource Window.Background}"
        DataContext="{Binding MainWindowViewModel, Source={StaticResource viewModelLocator}}">
    <interactivity:Interaction.Triggers>
        <interactivity:EventTrigger EventName="Loaded">
            <interactivity:InvokeCommandAction Command="{Binding LoadCommand}" />
        </interactivity:EventTrigger>
    </interactivity:Interaction.Triggers>

    <interactivity:Interaction.Behaviors>
        <bhv:EventToCommandBehavior Command="{Binding ClosingCommand}" Event="Closing" PassArguments="True" />
    </interactivity:Interaction.Behaviors>
    
    <Window.Resources>

        <converter:BoolToVisibilityConverter x:Key="boolToVisibilityConverter" />

        <Style TargetType="ListViewItem" x:Key="itemStyle">
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="IsEnabled" Value="{Binding IsAccessible}" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListViewItem">
                        <Border x:Name="border"
                                Padding="0" 
                                Background="{TemplateBinding Background}"
                                HorizontalAlignment="Stretch"
                            >
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <ContentPresenter x:Name="ContentSite"
                                                  VerticalAlignment="Stretch"
                                                  HorizontalAlignment="Stretch"/>
                                <Border Width="1"
                                        Grid.Column="1"
                                        Visibility="{Binding RelativeSource={RelativeSource AncestorType=ListViewItem}, Converter={StaticResource separatorConverter}}"
                                        Background="{Binding BorderBrush, RelativeSource={RelativeSource AncestorType=ListView}}" />
                            </Grid>

                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup x:Name="CommonStates">
                                    <VisualState x:Name="Normal" />
                                    <VisualState x:Name="MouseOver" />
                                </VisualStateGroup>
                                <VisualStateGroup x:Name="SelectionStates">
                                    <VisualState x:Name="Unselected" />
                                    <VisualState x:Name="Selected" />
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Border BorderThickness="0 0 0 1"
                    BorderBrush="{DynamicResource Separator.Background.Small}">
            <Grid Background="{DynamicResource MenuBar.Background}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <Grid Name="gridCommand"
                          DataContext="{Binding}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <Border Margin="0 2 10 2"
                            Grid.Column="1"
                            BorderThickness="1"
                            CornerRadius="4"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Center"
                            Padding="10 3">
                        <TextBlock Text="{Binding Source={x:Static Application.Current}, Path=User.Entite.Description, StringFormat=FingerPrintManager - \{0\}, FallbackValue='FingerPrintManager', TargetNullValue='FingerPrintManager'}"
                                   FontSize="13.5"
                                   Foreground="{DynamicResource Primary.Foreground}"
                           />
                    </Border>
                </Grid>

                <ListView Background="#fff"
                          BorderBrush="#dadada"
                          ItemsSource="{Binding PagesView}"
                          SelectedValue="{Binding CurrentPageViewModel}"
                          ItemTemplate="{DynamicResource SimpleOptionStyle.Item}"
                          ItemContainerStyle="{DynamicResource itemStyle}"
                          Style="{DynamicResource ListView.HorizontalSegmentedOptions.Style2}"
                          HorizontalAlignment="Center"
                          VerticalAlignment="Bottom"
                          Margin="20 10"
                          Grid.ColumnSpan="3"
                          Visibility="{Binding NotPresenter, Converter={StaticResource boolToVisibilityConverter}}"
                    />

                <Grid Grid.Column="2"
                      Margin="0 2">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <Border Grid.RowSpan="2" 
                                Cursor="Hand" 
                                Margin="2,0" 
                                Tag="-75" 
                                Name="borderUser" 
                                Padding="5" 
                                Width="30" 
                                Height="30" 
                                MouseDown="borderUser_MouseDown_1"
                                BorderBrush="#FF1E1E1E" 
                                BorderThickness="1" 
                                CornerRadius="15" 
                                Background="White">
                        <Path Width="16"
                                  Height="16"
                                  Stretch="Uniform"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center"
                                  Data="M16,2.0050001C12.416,2.0050001 9.5,5.0289993 9.5,8.7459979 9.5,12.462997 12.416,15.487996 16,15.487997 19.584,15.487996 22.5,12.462997 22.5,8.7459979 22.5,5.0289993 19.584,2.0050001 16,2.0050001z M16,0C20.687,0 24.5,3.9239988 24.5,8.7459979 24.5,11.760372 23.010548,14.423184 20.74917,15.996397L20.493732,16.165044 20.752514,16.244553C27.261414,18.335448,32,24.603727,32,31.991016L30,31.999989C30,24.00401 23.719971,17.505989 16,17.505989 8.2800293,17.505989 2,24.00401 2,31.991016L0,31.999989 0,31.991016C0,24.603727,4.7385874,18.335448,11.247486,16.244553L11.506267,16.165044 11.25083,15.996397C8.9894533,14.423184 7.5,11.760372 7.5,8.7459979 7.5,3.9239988 11.313,0 16,0z" 
                                  Fill="#FF1E1E1E"
                              />
                    </Border>

                    <Popup Name="popupUser" 
                               HorizontalAlignment="Center" 
                               Grid.Column="0" AllowsTransparency="True" 
                               HorizontalOffset="-75" VerticalOffset="-5" 
                               PlacementTarget="{Binding ElementName=borderUser}" 
                               Placement="Bottom"
                               StaysOpen="{Binding ElementName=borderUser, Path=IsMouseOver}">
                        <Grid Margin="10">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="20" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <Path Data="M0,20 L14,0 28,20z" 
                                  Fill="#FFFFFFFF" 
                                  HorizontalAlignment="Center"
                                  Panel.ZIndex="10">
                                <Path.Effect>
                                    <DropShadowEffect ShadowDepth="2" Opacity="0.2" Direction="90"/>
                                </Path.Effect>
                            </Path>

                            <Border Width="28"
                                    Height="4"
                                    Panel.ZIndex="11"
                                    Background="#fff"
                                    VerticalAlignment="Bottom"
                                    HorizontalAlignment="Center" 
                                    Margin="0 0 0 -3"/>

                            <Grid Grid.Row="1">
                                <Border Background="#FFFFFF">
                                    <Border.Effect>
                                        <DropShadowEffect ShadowDepth="0" Opacity="0.4"/>
                                    </Border.Effect>
                                </Border>
                                <Border Background="#FFFFFFFF" 
                                        Width="180" 
                                        CornerRadius="8" 
                                        Padding="10" >
                                    <StackPanel>
                                        <Button Content="Se connecter"
                                            Height="40"
                                            Command="{Binding LoginCommand}"
                                            Style="{DynamicResource ButtonOptionStyle}"
                                            Tag="M25.369838,3.2038372C24.618836,3.1938274 23.869849,3.4998594 23.346841,4.1018527 22.416856,5.1728428 22.551848,6.7788699 23.649848,7.6858576 24.745833,8.5938828 26.389821,8.4608863 27.319821,7.3918493 28.247809,6.3208592 28.114814,4.7148321 27.016814,3.8068679 26.537829,3.4088555 25.952826,3.2108562 25.369838,3.2038372z M21.936847,0.00081616286C24.143834,0.028831268 26.353826,0.77883557 28.167808,2.2818346 32.31878,5.716852 32.832784,11.78488 29.31581,15.838919 26.875825,18.648933 23.151851,19.711927 19.710864,18.972909L16.400889,22.785981C16.400889,22.785981,13.852903,22.622955,12.093927,23.23093L4.7509751,31.698018 0.26000805,32.000024 0,29.33802 11.109925,16.531917C11.008928,15.864921,10.894931,15.389942,10.894931,15.389942L12.738913,13.267921C11.383925,10.050862 11.827923,6.2378509 14.290903,3.3998223 16.267896,1.1208175 19.099877,-0.035194976 21.936847,0.00081616286z"/>

                                        <Button Content="Se déconnecter" 
                                            Height="40"
                                            Command="{Binding LogoutCommand}"
                                            Style="{DynamicResource ButtonOptionStyle}"
                                            Tag="M8.0170792,5.4661164C8.3718814,5.4721987 8.7116774,5.6682266 8.8869933,6.0050925 9.1419982,6.494103 8.9519957,7.0981027 8.4620055,7.3540825 4.4769896,9.4331698 1.9999999,13.512121 1.9999996,18.000007 1.9999999,24.617027 7.3829955,29.999926 14,29.999926 20.617004,29.999926 26,24.617027 26,18.000007 26,13.514074 23.52301,9.4360995 19.536987,7.3561577 19.048004,7.1011544 18.858002,6.4971547 19.113006,6.0071677 19.368988,5.5181574 19.970001,5.3261421 20.463013,5.5830985 25.110992,8.0081308 28,12.766033 28,18.000007 28,25.720047 21.720001,31.99991 14,31.99991 6.2799987,31.99991 -1.1931883E-07,25.720047 0,18.000007 -1.1931883E-07,12.76408 2.8890074,8.005079 7.5379943,5.5801688 7.6914309,5.4998317 7.8558053,5.4633516 8.0170792,5.4661164z M14,0C14.553,0,15,0.44700003,15,1L15,14C15,14.552999 14.553,15 14,15 13.446999,15 13,14.552999 13,14L13,1C13,0.44700003,13.446999,0,14,0z"/>

                                        <Button Content="Modifier compte" 
                                            Height="40"
                                            Command="{Binding EditAccountCommand}"
                                            Style="{DynamicResource ButtonOptionStyle}"
                                            Tag="M19.312381,27.48482L18.503085,29.661004 20.944314,29.115917z M24.540007,21.633355L20.390685,25.734296 22.789237,28.131621 26.97936,24.028763z M27.175001,19.029084L25.962399,20.227547 28.408086,22.629793 29.616994,21.446061z M10.602995,15C5.8599977,15 1.999999,18.829 1.999999,23.536 1.999999,24.895 3.1159983,26 4.4899979,26L17.731456,26 17.992104,25.299033 18.172095,25.116051 18.171058,25.116051 23.266144,20.080393 23.156942,19.84575C22.697614,18.897562 22.06124,18.03375 21.28199,17.31 19.682991,15.82 17.592992,15 15.397993,15L12.999995,15z M12.999995,2C9.9420033,2 7.45401,4.467 7.45401,7.5 7.45401,9.947 9.1090055,12.123 11.478999,12.791 12.461997,13.068 13.535994,13.069 14.521991,12.791 16.891984,12.122 18.54598,9.9459996 18.54598,7.5 18.54598,4.467 16.057987,2 12.999995,2z M12.999995,0C17.160984,0 20.545975,3.3639994 20.545975,7.5 20.545975,9.6899061 19.575261,11.720467 17.995872,13.115179L17.808254,13.274325 17.879796,13.290484C19.650854,13.712344 21.290927,14.584437 22.645989,15.846 23.445364,16.590375 24.124036,17.454672 24.656125,18.399828L24.764509,18.599506 26.399983,16.983108C26.614001,16.772111 26.895004,16.666856 27.175756,16.666978 27.456508,16.6671 27.737007,16.772599 27.950018,16.983108L31.969938,20.961079 31.999967,21.450059C31.999967,21.74208,31.88095,22.027051,31.672944,22.233074L23.04003,30.684984 22.706048,30.770982 17.325118,31.973977C17.245102,31.991006 17.165085,31.999978 17.085069,31.999978 16.769093,31.999978 16.464103,31.863993 16.252069,31.619976 15.987118,31.314985 15.91113,30.89 16.054073,30.511035L16.987776,28 4.4899979,28C2.013999,28 0,25.997 0,23.536 0,18.633812 3.3858614,14.50334 7.9561033,13.332249L8.1918802,13.274945 8.0051279,13.116582C6.4251604,11.721779 5.4540157,9.6905622 5.4540157,7.5 5.4540157,3.3639994 8.8390064,0 12.999995,0z"/>
                                    </StackPanel>
                                </Border>
                            </Grid>
                            
                        </Grid>

                    </Popup>

                    <Grid Grid.Column="1" 
                          TextBlock.Foreground="{DynamicResource Primary.Foreground}"
                          Margin="0 7 0 0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <TextBlock Text="utilisateur" 
                                   TextTrimming="CharacterEllipsis" 
                                   Margin="5,0" 
                                   FontSize="10"  />
                        <TextBlock Grid.Row="1" 
                                   Foreground="#000"
                                   Text="{Binding Source={x:Static Application.Current}, Path=User.UserName, FallbackValue='aucun', TargetNullValue='aucun'}" 
                                   FontWeight="Bold" 
                                   MaxWidth="120" 
                                   TextTrimming="CharacterEllipsis" 
                                   VerticalAlignment="Top"
                                   Margin="5,0" 
                                   FontSize="13"  />

                    </Grid>

                    <Border Width="1" Height="26" 
                            Grid.Column="6" 
                            VerticalAlignment="Center" 
                            Background="{DynamicResource Separator.Background}" 
                            Margin="5 7"/>

                    <Button VerticalAlignment="Center"
                            Cursor="Hand" 
                            Width="30"
                            Height="30"
                            Margin="5,0"
                            ToolTip="A Propos"
                            Command="{Binding AboutCommand}"
                            Background="#B2FF0046"
                            Foreground="#FAFFFFFF"
                            Tag="M6.1720122,26.640015L12.506012,26.640015 12.506012,31.999023 6.1720122,31.999023z M6.169998,22.900024L6.1737445,22.900024 6.1720122,23.064941z M10.068994,0C13.318025,0 15.754005,0.81201172 17.703046,2.4359741 19.490037,4.0609741 20.463,6.335022 20.463,9.0949707 20.463,10.882019 19.976001,12.669006 18.839034,14.130005 17.701032,15.591003 16.402993,17.052979 14.777989,18.028015 13.967013,18.677002 13.316011,19.328003 12.992036,20.139038 12.667023,20.78894 12.505035,21.764038 12.505035,22.900024L6.1737445,22.900024 6.1758092,22.703424C6.2137826,20.916021 6.5366138,19.440285 7.1460131,18.680054 7.7950018,17.705994 8.9320286,16.567993 10.71902,15.268982 11.693022,14.45697 12.506012,13.481995 13.155,12.507996 13.805026,11.533997 14.129001,10.395996 14.129001,9.2589722 14.129001,7.9589844 13.805026,6.822998 13.155,6.1740112 12.506012,5.3619995 11.531033,5.0360107 10.232019,5.0360107 9.0949925,5.0360107 8.2829788,5.3610229 7.4720028,6.0100098 6.6599892,6.6589966 6.3339995,7.6339722 6.3339995,8.7709961L0,8.7709961 0,8.6079712C1.7478305E-07,5.8480225 0.81097621,3.7360229 2.7600165,2.2739868 4.7099722,0.81201172 6.9829882,0 10.068994,0z"
                            Grid.Column="7"
                            Style="{DynamicResource ButtonFlatIconStyle}">

                    </Button>
                </Grid>
            </Grid>

        </Border>
        <ContentPresenter Grid.Row="1"
                          Content="{Binding CurrentPageViewModel}"/>
    </Grid>
</Window>
